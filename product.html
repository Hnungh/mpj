<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title id="pageTitle">Product Detail - Nexus Wear</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&amp;family=Bebas+Neue&amp;display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Inter', sans-serif; background: #FFFFFF; color: #000; padding-bottom: 110px; }

        /* Navigation */
        .top-nav { position: fixed; top: 0; left: 0; right: 0; background: #FFF; z-index: 1000; border-bottom: 2px solid #000; height: 65px; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; }
        .logo-text { font-family: 'Bebas Neue'; font-size: 26px; text-decoration: none; color: #000; letter-spacing: 2px; }
        
        .nav-icons { display: flex; gap: 8px; align-items: center; }
        .icon-btn { cursor: pointer; transition: all 0.3s ease; background: none; border: none; padding: 8px; display: flex; align-items: center; justify-content: center; position: relative; text-decoration: none; }
        .icon-btn:hover { transform: scale(1.15) rotate(5deg); }
        .icon-btn:active { transform: scale(0.95); }
        .cart-badge { position: absolute; top: 2px; right: 2px; background: #FF4500; color: #FFF; font-size: 10px; font-weight: 900; padding: 2px 5px; border-radius: 10px; min-width: 18px; text-align: center; display: none; }

        /* Real Slider System */
        .slider-viewport { position: relative; width: 100%; aspect-ratio: 1/1; margin-top: 65px; overflow: hidden; background: #F2F2F2; border-bottom: 2px solid #000; }
        .slider-track { display: flex; transition: transform 0.4s cubic-bezier(0.165, 0.84, 0.44, 1); height: 100%; will-change: transform; }
        .slide { min-width: 100%; height: 100%; }
        .slide img { width: 100%; height: 100%; object-fit: cover; cursor: pointer; }
        .pg-badge { position: absolute; bottom: 15px; right: 15px; background: rgba(0,0,0,0.7); color: #fff; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 700; z-index: 10; letter-spacing: 1px; }

        /* Content Area */
        .content-main { padding: 25px 20px; max-width: 800px; margin: 0 auto; }
        .price-tag { font-family: 'Inter'; font-size: 36px; font-weight: 900; color: #FF4500; letter-spacing: -1.5px; line-height: 1; }
        .product-name { font-size: 17px; font-weight: 500; color: #333; margin: 10px 0; text-transform: uppercase; letter-spacing: 0.5px; line-height: 1.4; }
        
        .section-divider { margin: 25px 0 20px 0; border-top: 1px solid #EEE; }
        .section-title { font-family: 'Bebas Neue'; font-size: 22px; color: #000; letter-spacing: 2px; margin-bottom: 12px; display: block; }
        .desc-body { font-size: 14px; color: #666; line-height: 1.8; }

        /* Bottom Bar */
        .action-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #FFF; border-top: 2px solid #000; padding: 12px 20px; display: flex; align-items: center; gap: 15px; z-index: 1001; max-width: 800px; margin: 0 auto; height: 90px; }
        .seller-hub { display: flex; flex-direction: column; align-items: center; text-decoration: none; min-width: 60px; }
        .seller-avatar { width: 48px; height: 48px; border-radius: 50%; border: 2.5px solid #000; object-fit: cover; background: #F5F5F5; display: flex; align-items: center; justify-content: center; font-size: 22px; }
        .seller-avatar img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }
        .seller-label { font-size: 9px; font-weight: 800; color: #000; margin-top: 5px; text-transform: uppercase; letter-spacing: 0.5px; }
        
        .btn-core { flex: 1; height: 54px; font-family: 'Bebas Neue'; font-size: 19px; letter-spacing: 1.5px; border: 2.5px solid #000; transition: 0.2s; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .btn-add { background: #FFF; color: #000; }
        .btn-buy { background: #000; color: #FFF; }
        .btn-core:active { transform: scale(0.97); background: #f0f0f0; color: #000; }



        /* Toast Notification */
        .toast { position: fixed; bottom: 110px; left: 20px; right: 20px; max-width: 760px; margin: 0 auto; background: #000; color: #FFF; padding: 16px 20px; font-size: 14px; font-weight: 600; opacity: 0; transform: translateY(20px); transition: all 0.3s ease; z-index: 2000; pointer-events: none; border-radius: 8px; }
        .toast.show { opacity: 1; transform: translateY(0); }

        /* Loading Overlay */
        .loading-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.95); display: none; align-items: center; justify-content: center; z-index: 3000; }
        .loading-overlay.active { display: flex; }
        .loading-spinner { width: 48px; height: 48px; border: 3px solid #E0E0E0; border-top-color: #000; border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Error State */
        .error-state { display: none; flex-direction: column; align-items: center; justify-content: center; padding: 60px 20px; text-align: center; min-height: 50vh; }
        .error-state.active { display: flex; }
        .error-icon { font-size: 64px; margin-bottom: 20px; }
        .error-title { font-family: 'Bebas Neue'; font-size: 32px; letter-spacing: 2px; margin-bottom: 12px; }
        .error-message { font-size: 14px; color: #666; margin-bottom: 24px; }
        .error-btn { padding: 16px 32px; background: #000; color: #FFF; border: 2px solid #000; font-family: 'Bebas Neue'; font-size: 18px; letter-spacing: 1.5px; cursor: pointer; text-decoration: none; display: inline-block; }
        .error-btn:active { transform: scale(0.97); }

        /* Slide Placeholder */
        .slide-placeholder { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 100px; background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%); cursor: pointer; }

        /* Full Gallery */
        #galleryView { position: fixed; inset: 0; background: #000; z-index: 5000; display: flex; flex-direction: column; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        #galleryView.active { opacity: 1; pointer-events: auto; }
        .gv-header { height: 60px; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; color: #FFF; }
        .gv-count { font-family: 'Inter'; font-size: 14px; font-weight: 600; letter-spacing: 0.5px; }
        .gv-close { font-size: 30px; cursor: pointer; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; }
        .gv-close:active { opacity: 0.6; }
        .gv-track { flex: 1; display: flex; align-items: center; transition: transform 0.4s cubic-bezier(0.165, 0.84, 0.44, 1); overflow: hidden; will-change: transform; }
        .gv-slide { min-width: 100%; display: flex; align-items: center; justify-content: center; height: 100%; }
        .gv-slide-placeholder { font-size: 200px; }

        /* Selection Sheet */
        .sheet-mask { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 2000; display: none; backdrop-filter: blur(5px); }
        .sheet-mask.active { display: block; }
        .sheet-body { position: fixed; bottom: -100%; left: 0; right: 0; background: #FFF; z-index: 2001; border-top: 4px solid #000; padding: 30px; transition: 0.4s cubic-bezier(0.165, 0.84, 0.44, 1); max-width: 800px; margin: 0 auto; border-radius: 25px 25px 0 0; max-height: 85vh; overflow-y: auto; }
        .sheet-body.active { bottom: 0; }
        .sheet-title { font-family: 'Bebas Neue'; font-size: 24px; margin-bottom: 20px; border-bottom: 2px solid #000; padding-bottom: 10px; letter-spacing: 2px; }
        .sheet-product-preview { display: flex; gap: 15px; margin-bottom: 25px; padding: 15px; background: #F8F8F8; border-radius: 8px; align-items: center; }
        .sheet-product-img { width: 80px; height: 80px; object-fit: cover; border-radius: 6px; border: 2px solid #E0E0E0; }
        .sheet-product-info { flex: 1; }
        .sheet-product-name { font-size: 14px; font-weight: 600; color: #000; margin-bottom: 6px; }
        .sheet-product-price { font-size: 18px; font-weight: 900; color: #FF4500; }
        .sheet-label { font-size: 11px; font-weight: 800; margin-bottom: 10px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; }
        .chip-box { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 25px; }
        .chip { padding: 12px 20px; border: 2px solid #EEE; font-size: 13px; font-weight: 700; cursor: pointer; transition: 0.15s; }
        .chip:active { transform: scale(0.95); }
        .chip.active { border-color: #000; background: #000; color: #FFF; }
        .chip.sold-out { opacity: 0.3; cursor: not-allowed; }
        .quantity-control { display: flex; align-items: center; gap: 12px; margin-bottom: 25px; }
        .qty-btn { width: 32px; height: 32px; border: 2px solid #CCCCCC; background: #FFFFFF; color: #000000; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; font-weight: 700; transition: all 0.2s ease; }
        .qty-btn:hover { background: #000000; color: #FFFFFF; border-color: #000000; }
        .qty-btn:active { transform: scale(0.9); }
        .qty-input { width: 60px; height: 36px; text-align: center; font-size: 15px; font-weight: 700; border: 2px solid #E0E0E0; background: #FFFFFF; color: #000000; border-radius: 6px; padding: 0; }
        .qty-input:focus { outline: none; border-color: #000000; }
        .final-btn { width: 100%; height: 60px; font-family: 'Bebas Neue'; font-size: 19px; letter-spacing: 1.5px; border: 2.5px solid #000; background: #000; color: #FFF; cursor: pointer; }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body><!-- Loading Overlay -->
  <div class="loading-overlay active" id="loadingOverlay">
   <div class="loading-spinner"></div>
  </div><!-- Toast Notification -->
  <div class="toast" id="toast"><span id="toastMessage">Added to cart</span>
  </div><!-- Top Navigation -->
  <nav class="top-nav"><a href="#" class="logo-text" id="brandLogo" onclick="window.history.back(); return false;">NEXUS</a>
   <div class="nav-icons"><button class="icon-btn" aria-label="Share" id="shareBtn" onclick="handleShare()">
     <svg width="26" height="26" viewbox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round">
       <g transform="translate(2.000000, 5.000000)" stroke="#000000" stroke-width="2.5">
        <polyline points="13 0 20 7 13 14"></polyline>
        <path d="M0,12 C0,12 0,7 7,7 L20,7"></path>
       </g>
      </g>
     </svg></button> <a href="cart.html" class="icon-btn" aria-label="Cart" id="cartBtn">
     <svg width="26" height="26" viewbox="0 0 24 24" fill="none" stroke="#000000" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle> <circle cx="20" cy="21" r="1"></circle> <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
     </svg><span class="cart-badge" id="cartBadge">0</span> </a>
   </div>
  </nav><!-- Error State -->
  <div class="error-state" id="errorState">
   <div class="error-icon">
    ‚ö†Ô∏è
   </div>
   <h2 class="error-title">Product Not Found</h2>
   <p class="error-message">The product you're looking for doesn't exist or has been removed.</p><a href="#" class="error-btn" onclick="window.history.back(); return false;">Go Back</a>
  </div><!-- Image Slider -->
  <div class="slider-viewport" id="sliderViewport">
   <div class="slider-track" id="sliderTrack"></div>
   <div class="pg-badge" id="pgBadge">
    1/5
   </div>
  </div><!-- Main Content -->
  <div class="content-main" id="mainContent">
   <div class="price-tag" id="priceTag">
    ‡∏ø0
   </div>
   <h1 class="product-name" id="productName">Loading...</h1>
   <div class="section-divider"></div><span class="section-title">Product Details</span>
   <div class="desc-body" id="productDescription"></div>
  </div><!-- Bottom Action Bar -->
  <div class="action-bar"><a href="#" class="seller-hub" id="sellerHub">
    <div class="seller-avatar" id="sellerAvatar">
     üè™
    </div><span class="seller-label" id="sellerLabel">SHOP</span> </a> <button class="btn-core btn-add" onclick="toggleSheet('cart')">ADD TO CART</button> <button class="btn-core btn-buy" onclick="toggleSheet('buy')">BUY NOW</button>
  </div><!-- Selection Sheet -->
  <div class="sheet-mask" id="sheetMask" onclick="hideSheet()"></div>
  <div class="sheet-body" id="sheetBody">
   <div class="sheet-title">
    CONFIGURE ITEM
   </div>
   <div class="sheet-product-preview"><img id="sheetProductImage" src="" alt="Product" class="sheet-product-img">
    <div class="sheet-product-info">
     <div class="sheet-product-name" id="sheetProductName"></div>
     <div class="sheet-product-price" id="sheetProductPrice"></div>
    </div>
   </div>
   <p class="sheet-label">Select Color</p>
   <div class="chip-box" id="sheetColorGrid"></div>
   <p class="sheet-label">Select Size</p>
   <div class="chip-box" id="sheetSizeGrid"></div>
   <p class="sheet-label">Quantity</p>
   <div class="quantity-control"><button type="button" class="qty-btn" onclick="updateQuantity(-1)">‚àí</button> <input type="number" class="qty-input" id="quantityInput" value="1" min="1" max="99" onchange="validateQuantity()"> <button type="button" class="qty-btn" onclick="updateQuantity(1)">+</button>
   </div><button id="finalBtn" class="final-btn">CONFIRM</button>
  </div><!-- Full Gallery View -->
  <div id="galleryView">
   <div class="gv-header"><span class="gv-count" id="gvCount">1 / 1</span> <span class="gv-close" onclick="closeGallery()">‚úï</span>
   </div>
   <div class="gv-track" id="gvTrack"></div>
  </div>
  <script>
        // 1. DATA CENTER (Real product database)
        const MOCK_PRODUCTS_DATA = [
            {
                id: 'oversized-tee-black',
                name: 'Classic Black Oversized Tee',
                price: 790,
                desc: 'Premium cotton 100%, heavy weight fabric. Minimalist aesthetics blended with durability for the modern urban explorer.',
                images: [
                    'https://hnungh.github.io/mpj/img/oversized-tee-black.jpg',
                    'https://hnungh.github.io/mpj/img/hoodie-grey.jpg'
                ],
                colors: ['Black', 'White'],
                sizes: ['S', 'M', 'L', 'XL'],
                soldOutSizes: [],
                specifications: [
                    'Material: 100% Premium Cotton',
                    'Weight: 280g',
                    'Oversized fit',
                    'Pre-shrunk fabric',
                    'Made in Thailand'
                ],
                seller: { name: 'NEXUS OFFICIAL', logo: 'https://via.placeholder.com/100/000?text=NW', link: '#' }
            },
            {
                id: 'cargo-pants-olive',
                name: 'Military Olive Cargo Pants',
                price: 1590,
                desc: 'Durable military-style cargo pants with 6-pocket functional design.',
                images: [
                    'https://hnungh.github.io/mpj/img/cargo-pants-olive.jpg',
                    'https://hnungh.github.io/mpj/img/sunglasses-retro.jpg',
                    'https://hnungh.github.io/mpj/img/oversized-tee-black.jpg'
                ],
                colors: ['Olive', 'Dark'],
                sizes: ['30', '32', '34', '36'],
                soldOutSizes: [],
                specifications: [
                    'Material: Cotton Ripstop',
                    'Weight: 450g',
                    '6-pocket design',
                    'Reinforced stitching',
                    'Made in Vietnam'
                ],
                seller: { name: 'STREET WEAR', logo: 'https://via.placeholder.com/100/000?text=SW', link: '#' }
            },
            {
                id: 'sunglasses-retro',
                name: 'sunglasses-retro kyky',
                price: 890,
                desc: 'Premium cotton 100%, heavy weight fabric. Minimalist aesthetics blended with durability for the modern urban explorer00877.',
                images: [
                    'https://hnungh.github.io/mpj/img/oversized-tee-black.jpg',
                    'https://hnungh.github.io/mpj/img/hoodie-grey.jpg',
                    'https://hnungh.github.io/mpj/img/mo.jpg'
                ],
                colors: ['Black'],
                sizes: ['S', 'M', 'L', 'XL', '2XL'],
                soldOutSizes: [],
                specifications: [
                    'Material: 100% Premium Cotton',
                    'Weight: 280g',
                    'Oversized fit',
                    'Pre-shrunk fabric',
                    'Made in Cambodia'
                ],
                seller: { name: 'BARDS', logo: 'https://hnungh.github.io/mpj/img/hoodie-grey.jpg', link: '#' }
            }
        ];

        // State
        let currentIdx = 0;
        let selectedProduct = null;
        let selectedColor = null;
        let selectedSize = null;
        let sheetMode = 'cart';
        let currentQuantity = 1;

        // 2. ENGINE: Load Data From URL
        function loadSystem() {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            
            selectedProduct = MOCK_PRODUCTS_DATA.find(p => p.id === productId);

            if (!selectedProduct) {
                showError();
                return;
            }

            // Set defaults
            selectedColor = selectedProduct.colors[0];
            selectedSize = selectedProduct.sizes[0];

            renderProduct();
            hideLoading();
        }

        // 3. RENDER: Build UI Automatically
        function renderProduct() {
            document.getElementById('pageTitle').innerText = `${selectedProduct.name} - Nexus Wear`;
            document.getElementById('brandLogo').innerText = 'NEXUS';
            document.getElementById('priceTag').innerText = `‡∏ø${selectedProduct.price.toLocaleString()}`;
            document.getElementById('productName').innerText = selectedProduct.name;
            document.getElementById('productDescription').innerText = selectedProduct.desc;

            const track = document.getElementById('sliderTrack');
            const gvTrack = document.getElementById('gvTrack');
            
            track.innerHTML = '';
            gvTrack.innerHTML = '';
            
            selectedProduct.images.forEach((src, i) => {
                track.innerHTML += `<div class="slide"><img src="${src}" onclick="openGallery(${i})" onerror="this.parentElement.innerHTML='<div class=\\'slide-placeholder\\' onclick=\\'openGallery(${i})\\'>üñºÔ∏è</div>'"></div>`;
                gvTrack.innerHTML += `<div class="gv-slide"><img src="${src}" style="width: 100%; max-height: 85vh; object-fit: contain;" onerror="this.parentElement.innerHTML='<div class=\\'gv-slide-placeholder\\'>üñºÔ∏è</div>'"></div>`;
            });

            renderSeller(selectedProduct.seller);
            updatePagination();
            initSwipe();
            updateCartBadge();
        }

        // 4. SLIDER LOGIC
        function updatePagination() {
            const total = selectedProduct.images.length;
            document.getElementById('pgBadge').innerText = `${currentIdx + 1} / ${total}`;
            document.getElementById('sliderTrack').style.transform = `translateX(-${currentIdx * 100}%)`;
            document.getElementById('gvCount').innerText = `${currentIdx + 1} / ${total}`;
            document.getElementById('gvTrack').style.transform = `translateX(-${currentIdx * 100}%)`;
        }

        function initSwipe() {
            let startX = 0;
            let isDragging = false;
            const container = document.getElementById('sliderViewport');
            const gv = document.getElementById('galleryView');
            const track = document.getElementById('sliderTrack');
            const gvTrack = document.getElementById('gvTrack');

            const handleStart = (e) => {
                startX = e.touches ? e.touches[0].clientX : e.clientX;
                isDragging = true;
            };

            const handleMove = (e) => {
                if (!isDragging) return;
                e.preventDefault();
            };

            const handleEnd = (e) => {
                if (!isDragging) return;
                isDragging = false;
                let endX = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
                let diff = startX - endX;
                
                if (Math.abs(diff) > 50) {
                    if (diff > 0 && currentIdx < selectedProduct.images.length - 1) currentIdx++;
                    else if (diff < 0 && currentIdx > 0) currentIdx--;
                    updatePagination();
                }
            };

            // Main slider
            container.addEventListener('touchstart', handleStart, { passive: true });
            container.addEventListener('touchmove', handleMove, { passive: false });
            container.addEventListener('touchend', handleEnd, { passive: true });
            container.addEventListener('mousedown', handleStart);
            container.addEventListener('mousemove', handleMove);
            container.addEventListener('mouseup', handleEnd);

            // Gallery slider
            gv.addEventListener('touchstart', handleStart, { passive: true });
            gv.addEventListener('touchmove', handleMove, { passive: false });
            gv.addEventListener('touchend', handleEnd, { passive: true });
            gv.addEventListener('mousedown', handleStart);
            gv.addEventListener('mousemove', handleMove);
            gv.addEventListener('mouseup', handleEnd);
        }

        // Render seller
        function renderSeller(seller) {
            const avatar = document.getElementById('sellerAvatar');
            const label = document.getElementById('sellerLabel');
            const hub = document.getElementById('sellerHub');
            
            if (seller.logo && seller.logo.startsWith('http')) {
                avatar.innerHTML = `<img src="${seller.logo}" alt="${seller.name}" onerror="this.innerHTML='üè™'">`;
            } else {
                avatar.innerHTML = seller.logo || 'üè™';
            }
            
            label.textContent = seller.name;
            hub.href = seller.link;
        }

        function toggleSheet(mode) {
            sheetMode = mode;
            currentQuantity = 1;
            
            // Set product preview
            document.getElementById('sheetProductImage').src = selectedProduct.images[0];
            document.getElementById('sheetProductName').textContent = selectedProduct.name;
            document.getElementById('sheetProductPrice').textContent = `‡∏ø${selectedProduct.price.toLocaleString()}`;
            document.getElementById('quantityInput').value = currentQuantity;
            
            // Render chips
            const colorGrid = document.getElementById('sheetColorGrid');
            const sizeGrid = document.getElementById('sheetSizeGrid');
            
            colorGrid.innerHTML = selectedProduct.colors.map(c => 
                `<div class="chip ${c === selectedColor ? 'active' : ''}" onclick="setChip(this, 'color', '${c}')">${c}</div>`
            ).join('');
            
            sizeGrid.innerHTML = selectedProduct.sizes.map(s => 
                `<div class="chip ${s === selectedSize ? 'active' : ''}" onclick="setChip(this, 'size', '${s}')">${s}</div>`
            ).join('');

            document.getElementById('sheetMask').style.display = 'block';
            setTimeout(() => document.getElementById('sheetBody').classList.add('active'), 10);
            
            document.getElementById('finalBtn').onclick = () => {
                if(!selectedColor || !selectedSize) {
                    showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏™‡∏µ ‡πÅ‡∏•‡∏∞ ‡πÑ‡∏ã‡∏™‡πå');
                    return;
                }
                
                if (mode === 'cart') {
                    addToCart();
                    showToast(`‡πÄ‡∏û‡∏¥‡πà‡∏° ${selectedProduct.name} (${currentQuantity}) ‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß! üõí`);
                } else {
                    showToast('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô...');
                }
                hideSheet();
            };
        }
        
        function updateQuantity(delta) {
            const input = document.getElementById('quantityInput');
            let newValue = currentQuantity + delta;
            
            if (newValue < 1) newValue = 1;
            if (newValue > 99) newValue = 99;
            
            currentQuantity = newValue;
            input.value = currentQuantity;
        }
        
        function validateQuantity() {
            const input = document.getElementById('quantityInput');
            let value = parseInt(input.value) || 1;
            
            if (value < 1) value = 1;
            if (value > 99) value = 99;
            
            currentQuantity = value;
            input.value = currentQuantity;
        }

        function addToCart() {
            const cartData = localStorage.getItem('cart');
            const cart = cartData ? JSON.parse(cartData) : [];
            
            const item = {
                id: selectedProduct.id,
                name: selectedProduct.name,
                price: selectedProduct.price,
                color: selectedColor,
                size: selectedSize,
                image: selectedProduct.images[0],
                quantity: currentQuantity
            };
            
            const existingIndex = cart.findIndex(i => 
                i.id === item.id && i.color === item.color && i.size === item.size
            );
            
            if (existingIndex >= 0) {
                cart[existingIndex].quantity += currentQuantity;
            } else {
                cart.push(item);
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartBadge();
        }

        function hideSheet() {
            document.getElementById('sheetBody').classList.remove('active');
            setTimeout(() => document.getElementById('sheetMask').style.display = 'none', 400);
        }

        function setChip(el, type, val) {
            el.parentElement.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            if(type === 'color') selectedColor = val; else selectedSize = val;
        }



        // 5. INTERACTION
        function openGallery(i) { 
            currentIdx = i; 
            updatePagination(); 
            document.getElementById('galleryView').classList.add('active');
        }
        
        function closeGallery() { 
            document.getElementById('galleryView').classList.remove('active');
        }

        // Share functionality
        function handleShare() {
            if (navigator.share && selectedProduct) {
                navigator.share({
                    title: selectedProduct.name,
                    text: `Check out ${selectedProduct.name} - ‡∏ø${selectedProduct.price.toLocaleString()}`,
                    url: window.location.href
                }).then(() => {
                    showToast('‡πÅ‡∏ä‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‚úì');
                }).catch((error) => {
                    // User cancelled share - don't show error
                    if (error.name !== 'AbortError') {
                        copyToClipboard();
                    }
                });
            } else {
                copyToClipboard();
            }
        }

        function copyToClipboard() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß! ‚úì');
            }).catch(() => {
                // Silently fail - don't show error
            });
        }

        // Cart badge update
        function updateCartBadge() {
            const cartData = localStorage.getItem('cart');
            const cart = cartData ? JSON.parse(cartData) : [];
            const badge = document.getElementById('cartBadge');
            const totalItems = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
            
            if (totalItems > 0) {
                badge.textContent = totalItems;
                badge.style.display = 'block';
            } else {
                badge.style.display = 'none';
            }
        }

        // Toast
        function showToast(message) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Loading & Error
        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        function showError() {
            hideLoading();
            document.getElementById('errorState').classList.add('active');
            document.getElementById('sliderViewport').style.display = 'none';
            document.getElementById('mainContent').style.display = 'none';
            document.querySelector('.action-bar').style.display = 'none';
        }

        // Initialize
        window.onload = loadSystem;
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9bdb90ff91ea45ad',t:'MTc2ODM3NzI3OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
